flows:
  - name: programacion
    description: "Programacion de Viajes"
    inflow:
      - name: ipfiltering
        type: WhiteBlackList@v1
        description: "Chequeo de IP remote. Solo permite llamadas desde 127.0.0.1"
        properties:
          kind: whitelist
          cidrs:
            - "127.0.0.1/32"
      - name: text2Json
        type: StrJson2Java@v1
        description: Convertir a Json real
      - name: transformToCore
        type: JsonTranslation@v1
        description: Transformar hacia el payload (code) de viajes
        properties:
          engine: velocity
          code: |
            [
              #foreach( $e in $payload )
              {
                "codigo": $e.get("oc"),
                "fechaEstimadaInicio": "$library.strToDate($e.get("fechaInicioReal"),"yyyyMMdd","YYYY-MM-dd")T$library.secondsToTime($e.get("horaInicioReal"),"HH:mm:ss")",
                "codigoAlmacen": $e.get("codOrigen"),
                "codEmpTra": $e.get("codTransportista"),
                "placaUnidad": $e.get("placaEquipo"),
                "licenciaTransportista": $e.get("licenciaConductor"),
                "codigoRuta": $e.get("codRuta"),
                "peso": 0,
                "tareas": [
                  {
                    "codOrigen": $e.get("codOrigen"),
                    "tipoTarea": "E",
                    "peso": $e.get("peso"),
                    "codProducto": $e.get("codMaterial"),
                    "cliente": {
                      "codigoCliente": $e.get("codDestino"),
                      "nombreCliente": "-",
                      "sede": {
                        "codigoSede": $e.get("codSede"),
                        "nombreSede": "-",
                        "direccion": "-",
                        "marca":{
                          "codigo": $e.get("codClienteInterno")
                        }
                      }
                    }
                  }
              }
              #end
            ]
    outflow: []
    exception: []
    #  - name: fault
    #    type: Fault@v1
    #    description: Reporte de falla
    #    properties:
    #      code: 1001
    #      message: Error al cargar en Qdrant